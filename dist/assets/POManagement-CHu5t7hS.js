import{j as e,l as F,a as w,b as v,d,i as C,e as o,p,q as m,c as $,s as S,r as f,t as g,v as q,w as M,m as N,x as K,y as k}from"./tremor-BDyE74TS.js";import{r as b}from"./vendor-BNdeyL7t.js";import{b as O,u as P,c as _}from"./query-Bh7O_uqd.js";import{a as j,p as D,E as I}from"./ErrorMessage-D2Rrvq7X.js";import{L as Q}from"./index-CJLZBgzX.js";import"./axios-CCb-kr4I.js";const E=l=>new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",maximumFractionDigits:0}).format(l),L=({data:l,onApprove:i,onReject:s,onViewDetail:r})=>{if(!l)return null;const a=n=>{switch(n){case"pending":return e.jsx(p,{color:"yellow",children:"검토중"});case"approved":return e.jsx(p,{color:"green",children:"승인됨"});case"rejected":return e.jsx(p,{color:"red",children:"반려됨"})}};return e.jsxs(F,{children:[e.jsx(w,{children:e.jsxs(v,{children:[e.jsx(d,{children:"PO 번호"}),e.jsx(d,{children:"프로젝트명"}),e.jsx(d,{children:"공급자"}),e.jsx(d,{children:"금액"}),e.jsx(d,{children:"구분"}),e.jsx(d,{children:"상태"}),e.jsx(d,{children:"액션"})]})}),e.jsx(C,{children:l.data.map(n=>e.jsxs(v,{children:[e.jsx(o,{children:n.po_number}),e.jsx(o,{children:n.project_name}),e.jsx(o,{children:n.supplier}),e.jsx(o,{children:E(n.amount)}),e.jsx(o,{children:e.jsx(p,{color:n.payment_type==="advance"?"blue":"purple",children:n.payment_type==="advance"?"선금":"잔금"})}),e.jsx(o,{children:a(n.status)}),e.jsx(o,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{size:"xs",variant:"secondary",onClick:()=>r==null?void 0:r(n),children:"상세"}),n.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{size:"xs",color:"green",onClick:()=>i==null?void 0:i(n),children:"승인"}),e.jsx(m,{size:"xs",color:"red",onClick:()=>s==null?void 0:s(n),children:"반려"})]})]})})]},n.id))})]})};function z({onSuccess:l}){const i=O(),[s,r]=b.useState({project_id:0,project_name:"",supplier:"",amount:0,payment_type:"advance",po_number:`PO-${new Date().getFullYear()}-${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,status:"pending",created_at:new Date().toISOString()}),{data:a}=P({queryKey:["projects"],queryFn:D.getAll}),n=_({mutationFn:t=>j.create(t),onSuccess:()=>{i.invalidateQueries({queryKey:["pos"]}),l(),r({project_id:0,project_name:"",supplier:"",amount:0,payment_type:"advance",po_number:`PO-${new Date().getFullYear()}-${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,status:"pending",created_at:new Date().toISOString()})}}),x=t=>{if(t.preventDefault(),!s.project_id||!s.supplier||!s.amount){alert("모든 필드를 입력해주세요.");return}const u=a==null?void 0:a.find(y=>y.project_id===s.project_id),h={project_id:s.project_id,project_name:(u==null?void 0:u.project_name)||"",po_number:s.po_number,supplier:s.supplier,amount:s.amount,payment_type:s.payment_type,status:s.status,created_at:new Date().toISOString()};n.mutate(h)};return e.jsxs($,{children:[e.jsx(S,{children:"PO 발행"}),e.jsxs("form",{onSubmit:x,className:"mt-4 space-y-4",children:[e.jsx("div",{children:e.jsx(f,{value:String(s.project_id),onValueChange:t=>r({...s,project_id:Number(t)}),placeholder:"프로젝트 선택",children:a==null?void 0:a.map(t=>e.jsx(g,{value:String(t.project_id),children:t.project_name},t.project_id))})}),e.jsx("div",{children:e.jsx(q,{placeholder:"공급자",value:s.supplier,onChange:t=>r({...s,supplier:t.target.value})})}),e.jsx("div",{children:e.jsx(M,{placeholder:"금액",value:s.amount,onValueChange:t=>r({...s,amount:t||0}),min:0})}),e.jsx("div",{children:e.jsxs(f,{value:s.payment_type,onValueChange:t=>r({...s,payment_type:t}),placeholder:"지급 유형",children:[e.jsx(g,{value:"advance",children:"선급금"}),e.jsx(g,{value:"balance",children:"잔금"})]})}),e.jsx(m,{type:"submit",loading:n.isPending,className:"w-full",children:"PO 발행"})]})]})}function G(){const[l,i]=b.useState(!1),s=O(),{data:r,isLoading:a,error:n}=P({queryKey:["pos"],queryFn:()=>j.getAll(1)}),x=_({mutationFn:c=>j.update({...c,status:"approved"}),onSuccess:()=>{s.invalidateQueries({queryKey:["pos"]})}}),t=_({mutationFn:c=>j.update({...c,status:"rejected"}),onSuccess:()=>{s.invalidateQueries({queryKey:["pos"]})}}),u=c=>{x.mutate(c)},h=c=>{t.mutate(c)},y=c=>{console.log("View PO:",c)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(S,{children:"PO 관리"}),e.jsx(N,{children:"발주서(PO) 발행 및 관리를 수행합니다."})]}),e.jsx(m,{color:"blue",onClick:()=>i(!0),children:"PO 발행"})]}),a?e.jsx(Q,{}):n?e.jsx(I,{message:"PO 목록을 불러오는데 실패했습니다."}):e.jsx(L,{data:r,onApprove:u,onReject:h,onViewDetail:y}),e.jsxs(K,{open:l,onClose:()=>i(!1),children:[e.jsx("div",{className:"fixed inset-0 bg-black/30"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(k,{className:"bg-white rounded-lg p-6",children:e.jsx(z,{onSuccess:()=>i(!1)})})})]})]})}export{G as default};
